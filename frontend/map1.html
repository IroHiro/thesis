<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Albay Crop Distribution - Top 5 Municipalities</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", sans-serif;
        }

        body {
            background-color: #2f3b1f;
            color: #fff;
            min-height: 100vh;
        }

        /* NAVBAR */
        .navbar {
            background-color: #263014;
            padding: 15px 40px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-links {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 40px;
        }

        .nav-links a {
            text-decoration: none;
            color: #cfe09c;
            font-weight: 500;
        }

        .nav-links a:hover {
            color: #ffffff;
        }

        /* HEADER */
        .header {
            background: linear-gradient(rgba(45, 60, 20, 0.9), rgba(45, 60, 20, 0.7)), 
                        url('https://images.unsplash.com/photo-1595435934247-5d33b7f92c70?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            line-height: 1.3;
            margin-bottom: 10px;
            color: #ffffff;
        }

        .header p {
            font-size: 1rem;
            margin-bottom: 15px;
            color: #e6efc8;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        /* MAIN CONTENT */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* MAP SECTION */
        .map-section {
            background-color: #3c4527;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #4a5430;
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #4a5430;
        }

        .map-title {
            color: #cfe09c;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .crop-selectors {
            display: flex;
            gap: 10px;
        }

        .crop-button {
            background-color: #4a5430;
            border: 2px solid #8fa163;
            border-radius: 4px;
            padding: 8px 15px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .crop-button:hover {
            background-color: #5a6438;
            border-color: #a0b173;
        }

        .crop-button.active {
            background-color: #f3f5e6;
            color: #2f3b1f;
            border-color: #f3f5e6;
        }

        .crop-button.corn.active {
            background-color: #FFA500;
            color: #2f3b1f;
            border-color: #FFA500;
        }

        .crop-button.rice.active {
            background-color: #4CAF50;
            color: #fff;
            border-color: #4CAF50;
        }

        .crop-button.banana.active {
            background-color: #FFEB3B;
            color: #2f3b1f;
            border-color: #FFEB3B;
        }

        /* MAP CONTAINER - SMALLER */
        .map-container {
            height: 400px;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            position: relative;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        /* MAP INFO BAR */
        .map-info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: #4a5430;
            border-radius: 6px;
            margin-top: 15px;
        }

        .stats {
            display: flex;
            gap: 25px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #f3f5e6;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #cfe09c;
        }

        .legend {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #8fa163;
        }

        /* MUNICIPALITIES GRID - BELOW MAP */
        .municipalities-section {
            background-color: #3c4527;
            border-radius: 8px;
            padding: 25px;
            border: 1px solid #4a5430;
        }

        .section-title {
            color: #cfe09c;
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #4a5430;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .municipalities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .municipality-card {
            background-color: #4a5430;
            padding: 20px;
            border-radius: 6px;
            border-left: 4px solid #8fa163;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .municipality-card:hover {
            background-color: #5a6438;
            transform: translateY(-3px);
        }

        .municipality-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .municipality-name {
            font-weight: 600;
            color: #f3f5e6;
            font-size: 1.2em;
        }

        .total-farmers {
            background-color: #263014;
            color: #cfe09c;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
        }

        .current-crop {
            margin-bottom: 15px;
            color: #e6efc8;
            font-size: 0.95rem;
        }

        .crop-bars {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .crop-bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .crop-bar-label {
            width: 80px;
            font-size: 0.9rem;
            color: #cfe09c;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .crop-bar {
            flex: 1;
            background-color: #3c4527;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .crop-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .crop-fill.corn {
            background: linear-gradient(90deg, #FFA500, #FF8C00);
        }

        .crop-fill.rice {
            background: linear-gradient(90deg, #4CAF50, #388E3C);
        }

        .crop-fill.banana {
            background: linear-gradient(90deg, #FFEB3B, #FDD835);
        }

        .crop-value {
            width: 60px;
            text-align: right;
            font-weight: 600;
            color: #f3f5e6;
            font-size: 0.9rem;
        }

        /* FOOTER */
        .footer {
            background-color: #263014;
            padding: 25px 20px;
            text-align: center;
            border-top: 1px solid #3c4527;
            margin-top: 40px;
        }

        .footer p {
            color: #cfe09c;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .map-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .crop-selectors {
                width: 100%;
                justify-content: space-between;
            }
            
            .map-info-bar {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .stats {
                width: 100%;
                justify-content: space-around;
            }
            
            .legend {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .municipalities-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar">
        <ul class="nav-links">
            <li><a href="#home">Home</a></li>
            <li><a href="#map">Crop Map</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
        </ul>
    </nav>

    <!-- HEADER -->
    <header class="header">
        <h1>üåæ Albay Agricultural Monitoring System</h1>
        <p>Visualizing crop distribution across 5 key municipalities</p>
    </header>

    <!-- MAIN CONTENT -->
    <div class="main-container">
        <!-- MAP SECTION -->
        <div class="map-section">
            <div class="map-header">
                <div class="map-title">
                    <span>üìç</span> Interactive Crop Distribution Map
                </div>
                <div class="crop-selectors">
                    <button class="crop-button corn active" data-crop="Corn">
                        <span>üåΩ</span> Corn
                    </button>
                    <button class="crop-button rice" data-crop="Rice/Palay">
                        <span>üçö</span> Rice/Palay
                    </button>
                    <button class="crop-button banana" data-crop="Banana">
                        <span>üçå</span> Banana
                    </button>
                </div>
            </div>
            
            <div class="map-container">
                <div id="map"></div>
            </div>
            
            <div class="map-info-bar">
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalFarmers">0</div>
                        <div class="stat-label">Total Farmers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="currentCropCount">0</div>
                        <div class="stat-label" id="currentCropLabel">Corn Farmers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="municipalityCount">5</div>
                        <div class="stat-label">Municipalities</div>
                    </div>
                </div>
                
                <div class="legend" id="legend">
                    <!-- Legend will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- MUNICIPALITIES SECTION - BELOW MAP -->
        <div class="municipalities-section">
            <div class="section-title">
                <span>üèôÔ∏è</span> Municipalities Overview
            </div>
            
            <div class="municipalities-grid" id="municipalityList">
                <!-- Municipality cards will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
        <p>Data Source: RSBSA Registry | Project: Data-Driven Crop Suitability and Yield Prediction for Climate-Adaptive Agriculture in Albay</p>
        <p>¬© 2024 Albay Agricultural Research Initiative | Using Random Forest & LSTM Models</p>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Data for the 5 focus municipalities
        const municipalityData = {
            "CITY OF LIGAO": {
                "total": 8233,
                "coordinates": [13.2167, 123.5167],
                "crops": {
                    "Corn": 863,
                    "Rice/Palay": 1677,
                    "Banana": 496
                },
                "description": "Major agricultural hub with diversified crops"
            },
            "PIO DURAN": {
                "total": 6226,
                "coordinates": [13.0333, 123.4500],
                "crops": {
                    "Corn": 1131,
                    "Rice/Palay": 2313,
                    "Banana": 146
                },
                "description": "Rice-dominated agriculture with significant corn production"
            },
            "MALINAO": {
                "total": 3802,
                "coordinates": [13.4000, 123.7000],
                "crops": {
                    "Corn": 465,
                    "Rice/Palay": 152,
                    "Banana": 545
                },
                "description": "Banana-focused with diverse fruit cultivation"
            },
            "POLANGUI": {
                "total": 4446,
                "coordinates": [13.3167, 123.4833],
                "crops": {
                    "Corn": 969,
                    "Rice/Palay": 146,
                    "Banana": 676
                },
                "description": "Strong in banana and corn production"
            },
            "OAS": {
                "total": 7508,
                "coordinates": [13.2667, 123.4833],
                "crops": {
                    "Corn": 656,
                    "Rice/Palay": 1930,
                    "Banana": 297
                },
                "description": "Rice cultivation center with balanced crop mix"
            }
        };

        // Labels for the 5 municipalities only
        const municipalityLabels = [
            { name: "CITY OF LIGAO", coords: [13.2167, 123.5167] },
            { name: "PIO DURAN", coords: [13.0333, 123.4500] },
            { name: "MALINAO", coords: [13.4000, 123.7000] },
            { name: "POLANGUI", coords: [13.3167, 123.4833] },
            { name: "OAS", coords: [13.2667, 123.4833] }
        ];

        // Initialize map
        const map = L.map('map').setView([13.25, 123.52], 10);

        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 15,
            minZoom: 8
        }).addTo(map);

        // Current selected crop
        let currentCrop = "Corn";

        // Store markers for each municipality
        const municipalityMarkers = {};
        const mapLabels = [];

        // Function to get color for a crop value
        function getColorForValue(value, maxValue) {
            if (!value || value === 0) return '#3c4527';
            
            const ratio = value / maxValue;
            if (ratio < 0.25) return '#FFEDA0';
            if (ratio < 0.5) return '#FEB24C';
            if (ratio < 0.75) return '#F03B20';
            return '#BD0026';
        }

        // Function to update statistics
        function updateStatistics() {
            const totalFarmers = Object.values(municipalityData)
                .reduce((sum, data) => sum + data.total, 0);
            
            const currentCropTotal = Object.values(municipalityData)
                .reduce((sum, data) => sum + (data.crops[currentCrop] || 0), 0);
            
            document.getElementById('totalFarmers').textContent = totalFarmers.toLocaleString();
            document.getElementById('currentCropCount').textContent = currentCropTotal.toLocaleString();
            document.getElementById('currentCropLabel').textContent = `${currentCrop} Farmers`;
        }

        // Function to update municipality list
        function updateMunicipalityList() {
            const container = document.getElementById('municipalityList');
            container.innerHTML = '';
            
            Object.entries(municipalityData).forEach(([name, data]) => {
                const cropValue = data.crops[currentCrop] || 0;
                const percentage = ((cropValue / data.total) * 100).toFixed(1);
                
                // Calculate bar widths for all 3 crops
                const maxCropValue = Math.max(...Object.values(data.crops));
                const cornWidth = maxCropValue > 0 ? (data.crops.Corn / maxCropValue) * 100 : 0;
                const riceWidth = maxCropValue > 0 ? (data.crops["Rice/Palay"] / maxCropValue) * 100 : 0;
                const bananaWidth = maxCropValue > 0 ? (data.crops.Banana / maxCropValue) * 100 : 0;
                
                const card = document.createElement('div');
                card.className = 'municipality-card';
                card.innerHTML = `
                    <div class="municipality-header">
                        <div class="municipality-name">${name}</div>
                        <div class="total-farmers">${data.total.toLocaleString()} farmers</div>
                    </div>
                    <div class="current-crop">
                        <strong>${currentCrop}:</strong> ${cropValue.toLocaleString()} farmers (${percentage}%)
                    </div>
                    <div class="crop-bars">
                        <div class="crop-bar-item">
                            <div class="crop-bar-label">üåΩ Corn</div>
                            <div class="crop-bar">
                                <div class="crop-fill corn" style="width: ${cornWidth}%"></div>
                            </div>
                            <div class="crop-value">${data.crops.Corn}</div>
                        </div>
                        <div class="crop-bar-item">
                            <div class="crop-bar-label">üçö Rice</div>
                            <div class="crop-bar">
                                <div class="crop-fill rice" style="width: ${riceWidth}%"></div>
                            </div>
                            <div class="crop-value">${data.crops["Rice/Palay"]}</div>
                        </div>
                        <div class="crop-bar-item">
                            <div class="crop-bar-label">üçå Banana</div>
                            <div class="crop-bar">
                                <div class="crop-fill banana" style="width: ${bananaWidth}%"></div>
                            </div>
                            <div class="crop-value">${data.crops.Banana}</div>
                        </div>
                    </div>
                `;
                
                // Add click event to center map on municipality
                card.addEventListener('click', () => {
                    map.setView(data.coordinates, 12);
                    if (municipalityMarkers[name]) {
                        municipalityMarkers[name].openPopup();
                    }
                });
                
                container.appendChild(card);
            });
        }

        // Function to add municipality labels to map
        function addMunicipalityLabels() {
            // Clear existing labels
            mapLabels.forEach(label => {
                if (label && label.remove) label.remove();
            });
            mapLabels.length = 0;
            
            // Add labels for the 5 municipalities only
            municipalityLabels.forEach(labelData => {
                const label = L.marker(labelData.coords, {
                    icon: L.divIcon({
                        className: 'municipality-label',
                        html: `<div style="
                            background: rgba(45, 60, 20, 0.85);
                            color: #f3f5e6;
                            padding: 4px 10px;
                            border-radius: 4px;
                            font-size: 12px;
                            font-weight: 600;
                            white-space: nowrap;
                            border: 1px solid #8fa163;
                            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
                            box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
                            cursor: pointer;
                        ">${labelData.name}</div>`,
                        iconSize: [100, 25],
                        iconAnchor: [50, 0]
                    })
                }).addTo(map);
                
                mapLabels.push(label);
                
                // Add click event to center on municipality
                label.on('click', function() {
                    map.setView(labelData.coords, 12);
                });
            });
        }

        // Function to update map based on selected crop
        function updateMap() {
            let maxValue = 0;
            
            // Find maximum value for the current crop
            Object.values(municipalityData).forEach(data => {
                const value = data.crops[currentCrop] || 0;
                if (value > maxValue) maxValue = value;
            });

            // Update legend
            updateLegend(maxValue);
            
            // Update statistics
            updateStatistics();

            // Clear existing markers (but keep labels)
            Object.values(municipalityMarkers).forEach(marker => {
                if (marker && marker.remove) marker.remove();
            });

            // Add markers for each municipality
            Object.entries(municipalityData).forEach(([name, data]) => {
                const coords = data.coordinates;
                const cropValue = data.crops[currentCrop] || 0;
                const percentage = ((cropValue / data.total) * 100).toFixed(1);
                
                // Calculate marker size based on value
                const radius = Math.max(15, Math.min(30, (cropValue / maxValue) * 25 + 15));
                
                // Create popup content (just like in your example)
                let popupContent = `<div style="color: #2f3b1f; padding: 10px; min-width: 250px;">
                    <h3 style="margin-bottom: 10px; color: #2f3b1f;">${name}</h3>
                    <p><strong>Total Farmers:</strong> ${data.total.toLocaleString()}</p>
                    <hr style="margin: 10px 0; border-color: #8fa163;">
                    <p><strong>${currentCrop}:</strong> ${cropValue.toLocaleString()} farmers</p>
                    <p><em>${percentage}% of municipality farmers</em></p>
                    <hr style="margin: 10px 0; border-color: #8fa163;">
                    <p><strong>All Crops:</strong></p>
                    <p>üåΩ Corn: ${data.crops.Corn.toLocaleString()}</p>
                    <p>üçö Rice: ${data.crops["Rice/Palay"].toLocaleString()}</p>
                    <p>üçå Banana: ${data.crops.Banana.toLocaleString()}</p>
                    <p style="margin-top: 10px; font-style: italic; color: #5a6438;">${data.description}</p>
                </div>`;
                
                // Create marker
                const marker = L.circleMarker(coords, {
                    radius: radius,
                    fillColor: getColorForValue(cropValue, maxValue),
                    color: '#263014',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map);
                
                municipalityMarkers[name] = marker;
                
                // Bind popup
                marker.bindPopup(popupContent);

                // Click to highlight
                marker.on('click', function() {
                    map.setView(coords, 12);
                });
            });
        }

        // Function to update legend
        function updateLegend(maxValue) {
            const legend = document.getElementById('legend');
            
            legend.innerHTML = `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #BD0026;"></div>
                    <span>High</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #F03B20;"></div>
                    <span>Medium</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #FEB24C;"></div>
                    <span>Low</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #FFEDA0;"></div>
                    <span>Very Low</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #3c4527;"></div>
                    <span>No Data</span>
                </div>
            `;
        }

        // Initialize crop buttons
        document.querySelectorAll('.crop-button').forEach(button => {
            button.addEventListener('click', function() {
                // Update active state
                document.querySelectorAll('.crop-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                // Update current crop
                currentCrop = this.dataset.crop;
                
                // Update map and list
                updateMap();
                updateMunicipalityList();
            });
        });

        // Initial render
        addMunicipalityLabels();
        updateMap();
        updateMunicipalityList();
        updateStatistics();
    </script>
</body>
</html>